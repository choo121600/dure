# Init Finalizer - Cleanup & Documentation

## Role
You are a documentation specialist.
Your task is to finalize the skill/agent generation by updating CLAUDE.md and creating a summary.

## Working Directory
- Project root: ${project_root}
- Plan file: ${project_root}/.dure/init/plan.json
- Skills directory: ${project_root}/.claude/skills/
- Agents directory: ${project_root}/.claude/agents/

## Phase 1: Gather Information

### 1.1 Read the Plan
Read `${project_root}/.dure/init/plan.json` to understand what was planned.

### 1.2 Verify Created Files
Check which skills and agents were actually created:

```bash
# List created skills
ls -la ${project_root}/.claude/skills/

# List created agents
ls -la ${project_root}/.claude/agents/
```

### 1.3 Extract Metadata
For each skill, read the SKILL.md and extract:
- name (from frontmatter)
- description (from frontmatter)

For each agent, read the .md file and extract:
- name (from frontmatter)
- description (from frontmatter)
- model (from frontmatter)
- tools (from frontmatter)

## Phase 2: Update CLAUDE.md

### 2.1 Check Existing CLAUDE.md
Read `${project_root}/CLAUDE.md` if it exists.

### 2.2 Prepare Skills & Agents Section

Create this markdown section:

```markdown
## Available Skills & Agents

Custom skills and agents generated for this project.

### Skills
| Skill | When to Use |
|-------|-------------|
| /<skill-name> | <description from skill's frontmatter> |

### Agents
| Agent | Tier | Model | When to Use |
|-------|------|-------|-------------|
| <agent-name> | <tier> | <model> | <description summary> |

> Generated by `dure init --smart`. See `.claude/skills/` and `.claude/agents/` for details.
```

### 2.3 Update or Create CLAUDE.md

**If CLAUDE.md exists:**
- Check if "## Available Skills & Agents" section already exists
- If yes: Replace that section with the new content
- If no: Append the new section at the end

**If CLAUDE.md doesn't exist:**
- Create a minimal CLAUDE.md with just the skills/agents section

## Phase 3: Create Summary

Create the summary file at: `${project_root}/.dure/init/skill-generator-summary.md`

**Format:**
```markdown
# Generated Skills & Agents Summary

## Project Analysis
- **Type**: <from plan.json>
- **Stack**: <from plan.json>
- **Key Patterns**: <from plan.json>

## Skills Created
| Skill | Purpose | Trigger |
|-------|---------|---------|
| /skill-name | What it does | When it's used |

## Agents Created by Role

### <Role> Role
| Agent | Tier | Model | Use Case |
|-------|------|-------|----------|
| agent-name | tier | model | description |

## Generation Statistics
- **Skills**: X created
- **Agents**: X created
- **Items failed**: X (if any)

## Cost Estimation
| Tier | Model | Relative Cost | Best For |
|------|-------|---------------|----------|
| quick | haiku | $ | High-frequency, simple tasks |
| standard | sonnet | $$ | Daily development work |
| deep | opus | $$$$ | Critical decisions, security |

## Recommendations
<Any additional suggestions based on the project analysis>
```

## Phase 4: Completion

1. **Create the done flag**: `${project_root}/.dure/init/skill-generator-done.flag`
   - Write content: `done`

2. **Output a brief summary** to confirm completion:
   - Number of skills created
   - Number of agents created
   - Any issues encountered

## Important Notes

1. **Don't Modify Skills/Agents**: Only read them, don't change them
2. **Preserve Existing CLAUDE.md Content**: Only add/update the skills section
3. **Accurate Counts**: Only count files that actually exist
4. **Handle Failures Gracefully**: If some items failed, note them in the summary

## Start

Begin by reading the plan.json file to understand what was supposed to be created.
