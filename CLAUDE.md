# Orchestral - CLAUDE.md

ì´ ë¬¸ì„œëŠ” Orchestral í”„ë¡œì íŠ¸ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì„¤ê³„ ëª…ì„¸ì„œë‹¤.

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### í•œ ì¤„ ì •ì˜

> **ì˜ë„ë¥¼ ì…ë ¥í•˜ë©´, ë„¤ ê°œì˜ ì—ì´ì „íŠ¸ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³ ,
> ì¸ê°„ì€ ì¦ê±°ë¥¼ ë³´ê³  ê²°ì •ë§Œ í•˜ëŠ” ì—”ì§€ë‹ˆì–´ë§ ì‹œìŠ¤í…œ**

### ëª©í‘œ

- "Agentic Software Engineering" íŒ¨ëŸ¬ë‹¤ì„ì´ ì‹¤ì œë¡œ ë™ì‘í•¨ì„ ì¦ëª…í•˜ëŠ” **MVP**
- ì™„ì„±í˜• ì œí’ˆì´ ì•„ë‹Œ **ê³µí•™ì  ê²€ì¦**

---

## 2. í•µì‹¬ ì›ì¹™

1. **ì¸ê°„ì€ íŒë‹¨ ë…¸ë“œë‹¤** - ì‘ì—…ìê°€ ì•„ë‹ˆë¼ ê²°ì •ê¶Œì
2. **ê¶¤ì (Trajectory)ì´ 1ê¸‰ ì‚°ì¶œë¬¼** - ê²°ê³¼ë¬¼ë³´ë‹¤ ë„ë‹¬ ê³¼ì •ì´ ì¤‘ìš”
3. **ì¬í˜„ ê°€ëŠ¥í•´ì•¼ í•œë‹¤** - ëª¨ë“  ì‹¤í–‰ì€ ë¡œê·¸ë¡œ ê¸°ë¡
4. **íŒŒì¼ ê¸°ë°˜ ì¡°ìœ¨** - ì—ì´ì „íŠ¸ ê°„ í†µì‹ ì€ íŒŒì¼ì‹œìŠ¤í…œìœ¼ë¡œ

---

## 3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         orchestral                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   CLI (orchestral start)                                     â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ACE Web     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ .orchestral/                â”‚   â”‚
â”‚   â”‚ Server      â”‚         â”‚   â”œâ”€ config/                â”‚   â”‚
â”‚   â”‚ :3000       â”‚         â”‚   â””â”€ runs/                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                              â–²                     â”‚
â”‚         â”‚ Run ì‹œì‘                     â”‚                     â”‚
â”‚         â–¼                              â”‚                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                  tmux session                        â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚   â”‚  â”‚ Refiner  â”‚ Builder  â”‚ Verifier â”‚Gatekeeperâ”‚      â”‚   â”‚
â”‚   â”‚  â”‚ (pane 0) â”‚ (pane 1) â”‚ (pane 2) â”‚ (pane 3) â”‚      â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚   â”‚  â”‚ Debug Shell (pane 4)â”‚ ACE Server (pane 5)â”‚       â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ì—ì´ì „íŠ¸ ì •ì˜

### 4.1 Refiner

| í•­ëª© | ê°’ |
|------|-----|
| ì—­í•  | Briefing ê²€í†  ë° ê°œì„  |
| ê¸°ë³¸ ëª¨ë¸ | haiku |
| ì…ë ¥ | `briefing/raw.md` |
| ì¶œë ¥ | `briefing/refined.md`, `briefing/clarifications.json`, `briefing/log.md` |

**í–‰ë™ ê·œì¹™:**
- ì¶©ë¶„í•œ briefing â†’ `refined.md` ìƒì„±, ë‹¤ìŒ ë‹¨ê³„ë¡œ
- ê°œì„  ê°€ëŠ¥ â†’ `refined.md`ì— ë³´ì™„, `log.md`ì— ê·¼ê±° ê¸°ë¡
- ëª¨í˜¸í•¨ â†’ `crp/` ìƒì„±, ì¸ê°„ ì‘ë‹µ ëŒ€ê¸°

**ìë™ ê°œì„  í—ˆìš©:**
- ìˆ«ì ê¸°ë³¸ê°’
- ë„¤ì´ë° ì»¨ë²¤ì…˜
- íŒŒì¼ ê²½ë¡œ

**CRP í•„ìˆ˜:**
- ì•„í‚¤í…ì²˜ ê²°ì •
- ì™¸ë¶€ ì˜ì¡´ì„± ì¶”ê°€
- ë³´ì•ˆ ê´€ë ¨ ì‚¬í•­

### 4.2 Builder

| í•­ëª© | ê°’ |
|------|-----|
| ì—­í•  | ì½”ë“œ êµ¬í˜„ |
| ê¸°ë³¸ ëª¨ë¸ | sonnet |
| ì…ë ¥ | `briefing/refined.md`, `briefing/clarifications.json` |
| ì¶œë ¥ | `builder/output/`, `builder/log.md`, `builder/done.flag` |

**í–‰ë™ ê·œì¹™:**
- `refined.md` ê¸°ë°˜ìœ¼ë¡œ ì½”ë“œ ìƒì„±
- ì„¤ê³„ ê²°ì • ê·¼ê±°ë¥¼ `log.md`ì— ê¸°ë¡
- ì™„ë£Œ ì‹œ `done.flag` ìƒì„±

### 4.3 Verifier

| í•­ëª© | ê°’ |
|------|-----|
| ì—­í•  | í…ŒìŠ¤íŠ¸ ìƒì„± ë° ì‹¤í–‰, ë°˜ë¡€ íƒìƒ‰ |
| ê¸°ë³¸ ëª¨ë¸ | haiku |
| ì…ë ¥ | `briefing/refined.md`, `builder/output/` |
| ì¶œë ¥ | `verifier/tests/`, `verifier/results.json`, `verifier/log.md`, `verifier/done.flag` |

**í–‰ë™ ê·œì¹™:**
- Builder ì™„ë£Œ í›„ ì‹œì‘ (`builder/done.flag` ê°ì§€)
- ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸, ê²½ê³„ ì¡°ê±´ í…ŒìŠ¤íŠ¸ ìƒì„±
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ë¥¼ `results.json`ì— ê¸°ë¡
- ì‹¤íŒ¨ ì¼€ì´ìŠ¤, ì—£ì§€ ì¼€ì´ìŠ¤ ëª…ì‹œ

### 4.4 Gatekeeper

| í•­ëª© | ê°’ |
|------|-----|
| ì—­í•  | ì½”ë“œ ë¦¬ë·°, ìµœì¢… íŒì • |
| ê¸°ë³¸ ëª¨ë¸ | sonnet |
| ì…ë ¥ | ì „ì²´ ì•„í‹°íŒ©íŠ¸ (briefing/, builder/, verifier/) |
| ì¶œë ¥ | `gatekeeper/review.md`, `gatekeeper/verdict.json`, `mrp/` |

**íŒì • ê²°ê³¼:**
- `PASS` â†’ `mrp/` ìƒì„±, ì¸ê°„ì—ê²Œ ì œì¶œ
- `FAIL` â†’ `review.md`ì— ì‚¬ìœ , Phase 1ë¡œ ë³µê·€ (ì¬ì‹œë„)
- `NEEDS_HUMAN` â†’ `crp/` ìƒì„±, ì¸ê°„ ì‘ë‹µ ëŒ€ê¸°

---

## 5. í´ë” êµ¬ì¡°

### í”„ë¡œì íŠ¸ ë£¨íŠ¸

```
/my-project/                    # ì‚¬ìš©ì í”„ë¡œì íŠ¸
â”œâ”€â”€ src/                        # ê¸°ì¡´ ì½”ë“œ
â”œâ”€â”€ package.json
â”‚
â””â”€â”€ .orchestral/                # orchestral start ì‹œ ìƒì„±
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ global.json
    â”‚   â”œâ”€â”€ refiner.json
    â”‚   â”œâ”€â”€ builder.json
    â”‚   â”œâ”€â”€ verifier.json
    â”‚   â””â”€â”€ gatekeeper.json
    â”‚
    â””â”€â”€ runs/
        â””â”€â”€ run-{timestamp}/
```

### Run ë””ë ‰í† ë¦¬

```
run-{timestamp}/
â”œâ”€â”€ state.json                  # í˜„ì¬ ìƒíƒœ
â”œâ”€â”€ events.log                  # ì´ë²¤íŠ¸ ë¡œê·¸ (ì•Œë¦¼/ì „í™˜ ê¸°ë¡)
â”‚
â”œâ”€â”€ briefing/
â”‚   â”œâ”€â”€ raw.md                  # ì¸ê°„ ì›ë³¸ ì…ë ¥
â”‚   â”œâ”€â”€ refined.md              # Refiner ì¶œë ¥
â”‚   â”œâ”€â”€ clarifications.json     # í•´ì„/ë³´ì™„ ë‚´ìš©
â”‚   â””â”€â”€ log.md                  # Refiner ë¡œê·¸
â”‚
â”œâ”€â”€ builder/
â”‚   â”œâ”€â”€ output/                 # ìƒì„±ëœ ì½”ë“œ
â”‚   â”œâ”€â”€ log.md                  # ì„¤ê³„ ê·¼ê±°
â”‚   â”œâ”€â”€ done.flag               # ì™„ë£Œ ì‹ í˜¸
â”‚   â””â”€â”€ error.flag              # ì—ëŸ¬ ë°œìƒ ì‹œ (ì„ íƒì )
â”‚
â”œâ”€â”€ verifier/
â”‚   â”œâ”€â”€ tests/                  # ìƒì„±ëœ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ results.json            # í…ŒìŠ¤íŠ¸ ê²°ê³¼
â”‚   â”œâ”€â”€ log.md
â”‚   â””â”€â”€ done.flag
â”‚
â”œâ”€â”€ gatekeeper/
â”‚   â”œâ”€â”€ review.md               # ë¦¬ë·° ì½”ë©˜íŠ¸
â”‚   â”œâ”€â”€ verdict.json            # íŒì • ê²°ê³¼
â”‚   â””â”€â”€ log.md
â”‚
â”œâ”€â”€ crp/                        # Consultation Request Pack
â”‚   â”œâ”€â”€ crp-001.json
â”‚   â””â”€â”€ crp-002.json
â”‚
â”œâ”€â”€ vcr/                        # Version Controlled Resolution
â”‚   â”œâ”€â”€ vcr-001.json
â”‚   â””â”€â”€ vcr-002.json
â”‚
â””â”€â”€ mrp/                        # Merge-Readiness Pack
    â”œâ”€â”€ summary.md
    â”œâ”€â”€ code/                   # ìµœì¢… ì½”ë“œ ìŠ¤ëƒ…ìƒ·
    â”œâ”€â”€ tests/                  # ìµœì¢… í…ŒìŠ¤íŠ¸
    â””â”€â”€ evidence.json           # ì¦ê±° ë§í¬
```

---

## 6. ì‹¤í–‰ íë¦„

### Phase ë‹¤ì´ì–´ê·¸ë¨

```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                          â”‚
     â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ REFINE  â”‚â”€â”€â”€â–ºâ”‚  BUILD  â”‚â”€â”€â”€â–ºâ”‚ VERIFY  â”‚â”€â”€â”€â–ºâ”‚  GATE   â”‚       â”‚
â”‚ Phase 0 â”‚    â”‚ Phase 1 â”‚    â”‚ Phase 2 â”‚    â”‚ Phase 3 â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
     â–²              â–²                             â”‚             â”‚
     â”‚              â”‚                             â–¼             â”‚
     â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
     â”‚              â”‚         â”‚        Verdict?           â”‚     â”‚
     â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚              â”‚              â”‚         â”‚         â”‚        â”‚
     â”‚              â”‚            PASS      FAIL    NEEDS_HUMAN  â”‚
     â”‚              â”‚              â”‚         â”‚         â”‚        â”‚
     â”‚              â”‚              â–¼         â”‚         â–¼        â”‚
     â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚              â”‚         â”‚  MRP  â”‚      â”‚    â”‚  CRP   â”‚    â”‚
     â”‚              â”‚         â””â”€â”€â”€â”¬â”€â”€â”€â”˜      â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    â”‚
     â”‚              â”‚             â”‚          â”‚         â”‚        â”‚
     â”‚              â”‚             â–¼          â”‚         â–¼        â”‚
     â”‚              â”‚        [ì¸ê°„ ê²€í† ]      â”‚    [ì¸ê°„ ì‘ë‹µ]   â”‚
     â”‚              â”‚             â”‚          â”‚         â”‚        â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚
     â”‚                            â”‚                    â”‚        â”‚
     â”‚                            â–¼                    â”‚        â”‚
     â”‚                        [ì™„ë£Œ]                   â”‚        â”‚
     â”‚                                                 â”‚        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                                                â”‚
     iteration < max_iterations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìƒì„¸ íë¦„

```
T0   ì¸ê°„: briefing/raw.md ì‘ì„±
     state = { phase: "refine", iteration: 1 }

T1   Refiner ì‹¤í–‰
     â”œâ”€ ì¶©ë¶„ â†’ refined.md, phase: "build"
     â”œâ”€ ê°œì„  â†’ refined.md + log.md, phase: "build"
     â””â”€ ëª¨í˜¸ â†’ crp/ ìƒì„±, phase: "waiting_human"

T2   Builder ì‹¤í–‰
     - refined.md ì½ìŒ
     - output/ì— ì½”ë“œ ìƒì„±
     - done.flag ìƒì„±
     - phase: "verify"

T3   Verifier ì‹¤í–‰
     - builder/done.flag ê°ì§€ í›„ ì‹œì‘
     - tests/ ìƒì„±, í…ŒìŠ¤íŠ¸ ì‹¤í–‰
     - results.json ê¸°ë¡
     - done.flag ìƒì„±
     - phase: "gate"

T4   Gatekeeper ì‹¤í–‰
     - ì „ì²´ ì•„í‹°íŒ©íŠ¸ ê²€í† 
     - verdict.json ì‘ì„±
     â”œâ”€ PASS â†’ mrp/ ìƒì„±, phase: "ready_for_merge"
     â”œâ”€ FAIL â†’ review.md, phase: "build", iteration++
     â””â”€ NEEDS_HUMAN â†’ crp/ ìƒì„±, phase: "waiting_human"

T5   [PASS] ì¸ê°„: MRP ê²€í†  â†’ ìŠ¹ì¸ ë˜ëŠ” í”¼ë“œë°±
     [FAIL] Builder ì¬ì‹œì‘ (review.md ì°¸ì¡°)
     [NEEDS_HUMAN] ì¸ê°„: VCR ì‘ì„± â†’ í•´ë‹¹ ë‹¨ê³„ ì¬ì‹œì‘
```

---

## 7. ë°ì´í„° í¬ë§·

### 7.1 state.json

```json
{
  "run_id": "run-20240115-143022",
  "phase": "build",
  "iteration": 1,
  "max_iterations": 3,
  "started_at": "2024-01-15T14:30:22Z",
  "updated_at": "2024-01-15T14:32:15Z",
  "agents": {
    "refiner": { "status": "completed", "completed_at": "..." },
    "builder": { "status": "running", "started_at": "..." },
    "verifier": { "status": "pending" },
    "gatekeeper": { "status": "pending" }
  },
  "pending_crp": null,
  "history": [
    { "phase": "refine", "result": "completed", "timestamp": "..." }
  ]
}
```

### 7.2 CRP (Consultation Request Pack)

```json
{
  "crp_id": "crp-001",
  "created_at": "2024-01-15T14:35:00Z",
  "created_by": "refiner",
  "type": "clarification",
  "question": "Rate limitingì„ ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ì ìš©í• ê¹Œìš”?",
  "context": "briefingì— 'ì ì ˆí•œ rate limiting'ì´ë¼ê³ ë§Œ ëª…ì‹œë¨",
  "options": [
    {
      "id": "A",
      "label": "IPë‹¹ ë¶„ë‹¹ 60íšŒ",
      "description": "ì¼ë°˜ì ì¸ API ê¸°ë³¸ê°’",
      "risk": "ë‚®ìŒ"
    },
    {
      "id": "B",
      "label": "ì‚¬ìš©ìë‹¹ ë¶„ë‹¹ 100íšŒ",
      "description": "ì¸ì¦ëœ ì‚¬ìš©ì ê¸°ì¤€",
      "risk": "ì¸ì¦ ì‹œìŠ¤í…œ í•„ìš”"
    },
    {
      "id": "C",
      "label": "ì—”ë“œí¬ì¸íŠ¸ë³„ ì°¨ë“± ì ìš©",
      "description": "ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥",
      "risk": "êµ¬í˜„ ë³µì¡ë„ ì¦ê°€"
    }
  ],
  "recommendation": "A",
  "status": "pending"
}
```

### 7.3 VCR (Version Controlled Resolution)

```json
{
  "vcr_id": "vcr-001",
  "crp_id": "crp-001",
  "created_at": "2024-01-15T14:40:00Z",
  "decision": "A",
  "rationale": "MVPì—ì„œëŠ” ë‹¨ìˆœí•œ ë°©ì‹ìœ¼ë¡œ ì‹œì‘",
  "additional_notes": "ì¶”í›„ ì‚¬ìš©ìë³„ ì œí•œ ì¶”ê°€ ì˜ˆì •",
  "applies_to_future": true
}
```

### 7.4 MRP (Merge-Readiness Pack)

**summary.md:**
```markdown
# Merge-Readiness Pack

## Run ì •ë³´
- Run ID: run-20240115-143022
- ì´ iteration: 2
- ì™„ë£Œ ì‹œê°„: 2024-01-15T15:00:00Z

## ë³€ê²½ ì‚¬í•­
- `src/middleware/rateLimiter.ts` ì¶”ê°€
- `src/app.ts` ìˆ˜ì • (ë¯¸ë“¤ì›¨ì–´ ë“±ë¡)

## í…ŒìŠ¤íŠ¸ ê²°ê³¼
- ì´ 12ê°œ í…ŒìŠ¤íŠ¸
- í†µê³¼: 12
- ì‹¤íŒ¨: 0

## ì„¤ê³„ ê²°ì •
1. IP ê¸°ë°˜ ë¶„ë‹¹ 60íšŒ ì œí•œ (VCR-001)
2. express-rate-limit ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

## ë¦¬ë·° í†µê³¼ ì‚¬ìœ 
- ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
- ë³´ì•ˆ ê²€í†  ì™„ë£Œ
- ì„±ëŠ¥ ì˜í–¥ ë¯¸ë¯¸
```

**evidence.json:**
```json
{
  "tests": {
    "total": 12,
    "passed": 12,
    "failed": 0,
    "coverage": 85
  },
  "files_changed": [
    "src/middleware/rateLimiter.ts",
    "src/app.ts"
  ],
  "decisions": ["vcr-001"],
  "iterations": 2,
  "logs": {
    "refiner": "briefing/log.md",
    "builder": "builder/log.md",
    "verifier": "verifier/log.md",
    "gatekeeper": "gatekeeper/log.md"
  }
}
```

---

## 8. ì„¤ì • íŒŒì¼

### 8.1 global.json

```json
{
  "max_iterations": 3,
  "tmux_session_prefix": "orchestral",
  "web_port": 3000,
  "log_level": "info",
  "timeouts": {
    "refiner": 300000,
    "builder": 600000,
    "verifier": 300000,
    "gatekeeper": 300000
  },
  "timeout_action": "warn",
  "notifications": {
    "terminal_bell": true,
    "system_notify": false
  },
  "auto_retry": {
    "enabled": true,
    "max_attempts": 2,
    "recoverable_errors": ["crash", "timeout", "validation"]
  }
}
```

### 8.2 refiner.json

```json
{
  "model": "haiku",
  "auto_fill": {
    "allowed": ["numeric_defaults", "naming", "file_paths"],
    "forbidden": ["architecture", "external_deps", "security"]
  },
  "delegation_keywords": ["ì ë‹¹íˆ", "ì•Œì•„ì„œ", "í•©ë¦¬ì ìœ¼ë¡œ"],
  "max_refinement_iterations": 2
}
```

### 8.3 builder.json

```json
{
  "model": "sonnet",
  "style": {
    "prefer_libraries": [],
    "avoid_libraries": [],
    "code_style": "default"
  },
  "constraints": {
    "max_file_size_lines": 500,
    "require_types": false
  }
}
```

### 8.4 verifier.json

```json
{
  "model": "haiku",
  "test_coverage": {
    "min_percentage": 80,
    "require_edge_cases": true,
    "require_error_cases": true
  },
  "adversarial": {
    "enabled": true,
    "max_attack_vectors": 5
  }
}
```

### 8.5 gatekeeper.json

```json
{
  "model": "sonnet",
  "pass_criteria": {
    "tests_passing": true,
    "no_critical_issues": true,
    "min_test_coverage": 80
  },
  "max_iterations": 3,
  "auto_crp_triggers": [
    "security_concern",
    "breaking_change",
    "external_dependency_addition"
  ]
}
```

---

## 9. CLI ëª…ë ¹ì–´

### ê¸°ë³¸ ì‚¬ìš©

```bash
# í”„ë¡œì íŠ¸ í´ë”ì—ì„œ ì‹œì‘
cd /my-project
orchestral start

# ì˜µì…˜
orchestral start --port 3001        # í¬íŠ¸ ì§€ì •
orchestral start --no-browser       # ë¸Œë¼ìš°ì € ìë™ ì—´ê¸° ë¹„í™œì„±í™”
```

### ê¸°íƒ€ ëª…ë ¹ì–´

```bash
orchestral status                   # í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ run ìƒíƒœ
orchestral logs                     # ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸°
orchestral stop                     # í˜„ì¬ run ì¤‘ì§€
orchestral history                  # ê³¼ê±° run ëª©ë¡
```

---

## 10. ACE ì›¹ì„œë²„

### í˜ì´ì§€ êµ¬ì¡°

```
/                       # ëŒ€ì‹œë³´ë“œ (í˜„ì¬ ìƒíƒœ, ìµœê·¼ runs)
/settings               # ì—ì´ì „íŠ¸ë³„ ì„¤ì •
/run/new                # ìƒˆ run ì‹œì‘ (briefing ì…ë ¥)
/run/:id                # run ìƒì„¸ (ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™©)
/run/:id/crp/:crpId     # CRP ì‘ë‹µ í˜ì´ì§€
/run/:id/mrp            # MRP ê²€í†  í˜ì´ì§€
/history                # ê³¼ê±° runs ëª©ë¡
```

### ëŒ€ì‹œë³´ë“œ (/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Orchestral                           [Settings] [New Run]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Project: /my-project                                        â”‚
â”‚  Status: Running (Phase 2 - Verify)                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Current Run: run-20240115-143022                        â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  [âœ“ Refine] â†’ [âœ“ Build] â†’ [â— Verify] â†’ [ Gate]          â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  Iteration: 1/3                                          â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  [View Details]  [Stop]                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  Recent Runs:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ run-20240115-120000  â”‚ Completed â”‚ PASS  â”‚ [View]      â”‚ â”‚
â”‚  â”‚ run-20240114-180000  â”‚ Completed â”‚ FAIL  â”‚ [View]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CRP ì‘ë‹µ í˜ì´ì§€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Consultation Request                          CRP-001      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  From: Refiner                                               â”‚
â”‚  Question:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Rate limitingì„ ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ì ìš©í• ê¹Œìš”?                â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚ Context: briefingì— 'ì ì ˆí•œ rate limiting'ì´ë¼ê³ ë§Œ ëª…ì‹œë¨â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  Options:                                                    â”‚
â”‚                                                              â”‚
â”‚  â—‹ A. IPë‹¹ ë¶„ë‹¹ 60íšŒ (Recommended)                          â”‚
â”‚       ì¼ë°˜ì ì¸ API ê¸°ë³¸ê°’ / Risk: ë‚®ìŒ                       â”‚
â”‚                                                              â”‚
â”‚  â—‹ B. ì‚¬ìš©ìë‹¹ ë¶„ë‹¹ 100íšŒ                                   â”‚
â”‚       ì¸ì¦ëœ ì‚¬ìš©ì ê¸°ì¤€ / Risk: ì¸ì¦ ì‹œìŠ¤í…œ í•„ìš”            â”‚
â”‚                                                              â”‚
â”‚  â—‹ C. ì—”ë“œí¬ì¸íŠ¸ë³„ ì°¨ë“± ì ìš©                                â”‚
â”‚       ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥ / Risk: êµ¬í˜„ ë³µì¡ë„ ì¦ê°€              â”‚
â”‚                                                              â”‚
â”‚  Additional Notes:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  â˜ Apply this decision to future similar cases              â”‚
â”‚                                                              â”‚
â”‚  [Submit Decision]                                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. tmux ì„¸ì…˜ êµ¬ì„±

### ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    orchestral-run-{timestamp}                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Refiner    â”‚   Builder    â”‚   Verifier   â”‚   Gatekeeper    â”‚
â”‚   (pane 0)   â”‚   (pane 1)   â”‚   (pane 2)   â”‚   (pane 3)      â”‚
â”‚              â”‚              â”‚              â”‚                 â”‚
â”‚              â”‚              â”‚              â”‚                 â”‚
â”‚              â”‚              â”‚              â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        Debug Shell (pane 4)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ACE Server (pane 5)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìƒì„± ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
SESSION="orchestral-run-$1"

tmux new-session -d -s $SESSION -n main

# 4ê°œ ì—ì´ì „íŠ¸ pane
tmux split-window -h -t $SESSION:main
tmux split-window -h -t $SESSION:main.0
tmux split-window -h -t $SESSION:main.2

# Debug shell
tmux split-window -v -t $SESSION:main.0
tmux join-pane -v -s $SESSION:main.1 -t $SESSION:main.4

# ACE server
tmux split-window -v -t $SESSION:main.4

# ë ˆì´ì•„ì›ƒ ì¡°ì •
tmux select-layout -t $SESSION:main tiled
```

---

## 12. ì—ì´ì „íŠ¸ ì‹¤í–‰ ëª…ì„¸

### 12.1 ì‹¤í–‰ íë¦„ ê°œìš”

```
tmux pane ìƒì„±
       â”‚
       â–¼
claude --dangerously-skip-permissions ì‹¤í–‰
       â”‚
       â–¼
í”„ë¡¬í”„íŠ¸ íŒŒì¼ ê²½ë¡œ ì „ë‹¬ (--prompt-file)
       â”‚
       â–¼
ì—ì´ì „íŠ¸ ì‘ì—… ì‹œì‘
       â”‚
       â–¼
done.flag ìƒì„± â†’ ë‹¤ìŒ ì—ì´ì „íŠ¸ íŠ¸ë¦¬ê±°
```

### 12.2 ê° pane ì‹¤í–‰ ëª…ë ¹ì–´

**Pane 0 (Refiner):**
```bash
cd {project_root} && claude --dangerously-skip-permissions \
  --model {config.refiner.model} \
  --prompt-file .orchestral/runs/{run_id}/prompts/refiner.md
```

**Pane 1 (Builder):**
```bash
cd {project_root} && claude --dangerously-skip-permissions \
  --model {config.builder.model} \
  --prompt-file .orchestral/runs/{run_id}/prompts/builder.md
```

**Pane 2 (Verifier):**
```bash
cd {project_root} && claude --dangerously-skip-permissions \
  --model {config.verifier.model} \
  --prompt-file .orchestral/runs/{run_id}/prompts/verifier.md
```

**Pane 3 (Gatekeeper):**
```bash
cd {project_root} && claude --dangerously-skip-permissions \
  --model {config.gatekeeper.model} \
  --prompt-file .orchestral/runs/{run_id}/prompts/gatekeeper.md
```

**Pane 4 (Debug Shell):**
```bash
cd {project_root}
# ëŒ€ê¸° ìƒíƒœ - ì¸ê°„ ê°œì…ìš©
```

**Pane 5 (ACE Server):**
```bash
cd {project_root} && node .orchestral/server/index.js --port {config.web_port}
```

### 12.3 í”„ë¡¬í”„íŠ¸ íŒŒì¼ êµ¬ì¡°

```
.orchestral/runs/{run_id}/prompts/
â”œâ”€â”€ refiner.md
â”œâ”€â”€ builder.md
â”œâ”€â”€ verifier.md
â””â”€â”€ gatekeeper.md
```

### 12.4 í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿

**refiner.md:**
```markdown
# Refiner Agent

## ì—­í• 
ë‹¹ì‹ ì€ Orchestral ì‹œìŠ¤í…œì˜ Refiner ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.
ì¸ê°„ì´ ì‘ì„±í•œ briefingì„ ê²€í† í•˜ê³  ê°œì„ í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

## ì‘ì—… ë””ë ‰í† ë¦¬
- í”„ë¡œì íŠ¸ ë£¨íŠ¸: {project_root}
- Run ë””ë ‰í† ë¦¬: .orchestral/runs/{run_id}/

## ì…ë ¥
- ì›ë³¸ briefing: .orchestral/runs/{run_id}/briefing/raw.md

## ì¶œë ¥ (ë°˜ë“œì‹œ ìƒì„±í•´ì•¼ í•¨)
1. .orchestral/runs/{run_id}/briefing/refined.md
2. .orchestral/runs/{run_id}/briefing/clarifications.json
3. .orchestral/runs/{run_id}/briefing/log.md

## ì„¤ì •
{refiner_config_json}

## í–‰ë™ ê·œì¹™

### 1. Briefingì´ ì¶©ë¶„í•œ ê²½ìš°
- refined.mdì— raw.md ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬
- clarifications.jsonì— ë¹ˆ ê°ì²´ {}
- log.mdì— "ì¶©ë¶„í•¨" ê¸°ë¡

### 2. Briefing ê°œì„ ì´ ê°€ëŠ¥í•œ ê²½ìš°
- refined.mdì— ê°œì„ ëœ ë‚´ìš© ì‘ì„±
- clarifications.jsonì— í•´ì„/ë³´ì™„í•œ ë‚´ìš© ê¸°ë¡
- log.mdì— ë³€ê²½ ì‚¬í•­ê³¼ ê·¼ê±° ê¸°ë¡
- ìë™ ê°œì„  í—ˆìš©: {auto_fill_allowed}
- ìë™ ê°œì„  ê¸ˆì§€: {auto_fill_forbidden}

### 3. Briefingì´ ëª¨í˜¸í•œ ê²½ìš° (ì¸ê°„ íŒë‹¨ í•„ìš”)
- .orchestral/runs/{run_id}/crp/ ë””ë ‰í† ë¦¬ì— CRP íŒŒì¼ ìƒì„±
- CRP íŒŒì¼ëª…: crp-{timestamp}.json
- CRP í˜•ì‹:
```json
{
  "crp_id": "crp-001",
  "created_by": "refiner",
  "type": "clarification",
  "question": "ì§ˆë¬¸ ë‚´ìš©",
  "context": "ë§¥ë½ ì„¤ëª…",
  "options": [
    {"id": "A", "label": "ì„ íƒì§€A", "description": "ì„¤ëª…", "risk": "ë¦¬ìŠ¤í¬"}
  ],
  "recommendation": "A"
}
```

## ì™„ë£Œ ì¡°ê±´
- ëª¨ë“  ì¶œë ¥ íŒŒì¼ ìƒì„± ì™„ë£Œ
- ë˜ëŠ” CRP ìƒì„± ì™„ë£Œ

## ì¬ì‹œì‘ (VCR ì‘ë‹µ í›„)
- `/clear` í›„ ì´ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ ì¬ì‹œì‘ ìƒí™©
- ì´ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì„ ë‹¤ì‹œ ì½ìœ¼ì„¸ìš”: .orchestral/runs/{run_id}/prompts/refiner.md
- vcr/ ë””ë ‰í† ë¦¬ì—ì„œ ì¸ê°„ì˜ ê²°ì • í™•ì¸
- VCR ë‚´ìš©ì„ ë°˜ì˜í•˜ì—¬ ì‘ì—… ì¬ê°œ

## ì‹œì‘
raw.md íŒŒì¼ì„ ì½ê³  ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”.
```

**builder.md:**
```markdown
# Builder Agent

## ì—­í• 
ë‹¹ì‹ ì€ Orchestral ì‹œìŠ¤í…œì˜ Builder ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.
refined briefingì„ ê¸°ë°˜ìœ¼ë¡œ ì½”ë“œë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## ì‘ì—… ë””ë ‰í† ë¦¬
- í”„ë¡œì íŠ¸ ë£¨íŠ¸: {project_root}
- Run ë””ë ‰í† ë¦¬: .orchestral/runs/{run_id}/

## ì…ë ¥
- Refined briefing: .orchestral/runs/{run_id}/briefing/refined.md
- í•´ì„ ë‚´ìš©: .orchestral/runs/{run_id}/briefing/clarifications.json
- (ì¬ì‹œë„ ì‹œ) ë¦¬ë·° í”¼ë“œë°±: .orchestral/runs/{run_id}/gatekeeper/review.md
- (ìˆëŠ” ê²½ìš°) VCR: .orchestral/runs/{run_id}/vcr/

## ì¶œë ¥ (ë°˜ë“œì‹œ ìƒì„±í•´ì•¼ í•¨)
1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì½”ë“œ íŒŒì¼ë“¤ ìƒì„±/ìˆ˜ì •
2. .orchestral/runs/{run_id}/builder/output/ ì— ë³€ê²½ëœ íŒŒì¼ ëª©ë¡
3. .orchestral/runs/{run_id}/builder/log.md ì— ì„¤ê³„ ê·¼ê±°
4. .orchestral/runs/{run_id}/builder/done.flag ìƒì„± (ì™„ë£Œ ì‹ í˜¸)

## ì„¤ì •
{builder_config_json}

## í–‰ë™ ê·œì¹™
1. refined.mdì˜ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì‹¤íˆ êµ¬í˜„
2. ì„¤ê³„ ê²°ì •ë§ˆë‹¤ log.mdì— ê·¼ê±° ê¸°ë¡
3. ê¸°ì¡´ í”„ë¡œì íŠ¸ ì½”ë“œ ìŠ¤íƒ€ì¼ ì¤€ìˆ˜
4. ì¬ì‹œë„ì¸ ê²½ìš° review.md í”¼ë“œë°± ë°˜ì˜

## ì™„ë£Œ ì¡°ê±´
- ì½”ë“œ êµ¬í˜„ ì™„ë£Œ
- log.md ì‘ì„± ì™„ë£Œ
- done.flag íŒŒì¼ ìƒì„±

## ì¬ì‹œì‘ (iteration 2 ì´ìƒ)
- `/clear` í›„ ì´ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ ì¬ì‹œì‘ ìƒí™©
- ì´ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì„ ë‹¤ì‹œ ì½ìœ¼ì„¸ìš”: .orchestral/runs/{run_id}/prompts/builder.md
- state.jsonì—ì„œ í˜„ì¬ iteration í™•ì¸
- gatekeeper/review.mdì—ì„œ í”¼ë“œë°± í™•ì¸ í›„ ë°˜ì˜

## ì‹œì‘
refined.md íŒŒì¼ì„ ì½ê³  êµ¬í˜„ì„ ì‹œì‘í•˜ì„¸ìš”.
```

**verifier.md:**
```markdown
# Verifier Agent

## ì—­í• 
ë‹¹ì‹ ì€ Orchestral ì‹œìŠ¤í…œì˜ Verifier ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.
Builderê°€ ìƒì„±í•œ ì½”ë“œë¥¼ ê²€ì¦í•˜ê³  í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

## ì‘ì—… ë””ë ‰í† ë¦¬
- í”„ë¡œì íŠ¸ ë£¨íŠ¸: {project_root}
- Run ë””ë ‰í† ë¦¬: .orchestral/runs/{run_id}/

## ì…ë ¥
- Refined briefing: .orchestral/runs/{run_id}/briefing/refined.md
- Builder ë¡œê·¸: .orchestral/runs/{run_id}/builder/log.md
- Builder ì¶œë ¥: .orchestral/runs/{run_id}/builder/output/

## ì¶œë ¥ (ë°˜ë“œì‹œ ìƒì„±í•´ì•¼ í•¨)
1. .orchestral/runs/{run_id}/verifier/tests/ ì— í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤
2. .orchestral/runs/{run_id}/verifier/results.json (í…ŒìŠ¤íŠ¸ ê²°ê³¼)
3. .orchestral/runs/{run_id}/verifier/log.md (ê²€ì¦ ë¡œê·¸)
4. .orchestral/runs/{run_id}/verifier/done.flag (ì™„ë£Œ ì‹ í˜¸)

## ì„¤ì •
{verifier_config_json}

## í–‰ë™ ê·œì¹™
1. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‘ì„± (happy path)
2. ê²½ê³„ ì¡°ê±´ í…ŒìŠ¤íŠ¸ ì‘ì„±
3. ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ì‘ì„±
4. (adversarial í™œì„±í™” ì‹œ) ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ íƒìƒ‰
5. ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ results.jsonì— ê¸°ë¡

## results.json í˜•ì‹
```json
{
  "total": 10,
  "passed": 8,
  "failed": 2,
  "coverage": 85,
  "failures": [
    {"test": "í…ŒìŠ¤íŠ¸ëª…", "reason": "ì‹¤íŒ¨ ì‚¬ìœ "}
  ],
  "edge_cases_tested": ["ì¼€ì´ìŠ¤1", "ì¼€ì´ìŠ¤2"],
  "adversarial_findings": ["ë°œê²¬1"]
}
```

## ì™„ë£Œ ì¡°ê±´
- í…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì™„ë£Œ
- results.json ì‘ì„± ì™„ë£Œ
- done.flag íŒŒì¼ ìƒì„±

## ì¬ì‹œì‘ (VCR ì‘ë‹µ í›„)
- `/clear` í›„ ì´ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ ì¬ì‹œì‘ ìƒí™©
- ì´ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì„ ë‹¤ì‹œ ì½ìœ¼ì„¸ìš”: .orchestral/runs/{run_id}/prompts/verifier.md
- vcr/ ë””ë ‰í† ë¦¬ì—ì„œ ì¸ê°„ì˜ ê²°ì • í™•ì¸
- VCR ë‚´ìš©ì„ ë°˜ì˜í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì¬ê°œ

## ì‹œì‘
builder/done.flag í™•ì¸ í›„, briefingê³¼ ì½”ë“œë¥¼ ì½ê³  í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.
```

**gatekeeper.md:**
```markdown
# Gatekeeper Agent

## ì—­í• 
ë‹¹ì‹ ì€ Orchestral ì‹œìŠ¤í…œì˜ Gatekeeper ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.
ì „ì²´ ê²°ê³¼ë¬¼ì„ ê²€í† í•˜ê³  ìµœì¢… íŒì •ì„ ë‚´ë¦½ë‹ˆë‹¤.

## ì‘ì—… ë””ë ‰í† ë¦¬
- í”„ë¡œì íŠ¸ ë£¨íŠ¸: {project_root}
- Run ë””ë ‰í† ë¦¬: .orchestral/runs/{run_id}/

## ì…ë ¥
- Briefing: .orchestral/runs/{run_id}/briefing/
- Builder ê²°ê³¼: .orchestral/runs/{run_id}/builder/
- Verifier ê²°ê³¼: .orchestral/runs/{run_id}/verifier/
- VCR (ìˆëŠ” ê²½ìš°): .orchestral/runs/{run_id}/vcr/
- í˜„ì¬ ìƒíƒœ: .orchestral/runs/{run_id}/state.json

## ì¶œë ¥ (ë°˜ë“œì‹œ ìƒì„±í•´ì•¼ í•¨)
1. .orchestral/runs/{run_id}/gatekeeper/review.md (ë¦¬ë·° ì½”ë©˜íŠ¸)
2. .orchestral/runs/{run_id}/gatekeeper/verdict.json (íŒì • ê²°ê³¼)
3. (PASSì¸ ê²½ìš°) .orchestral/runs/{run_id}/mrp/ ë””ë ‰í† ë¦¬ ìƒì„±

## ì„¤ì •
{gatekeeper_config_json}

## í–‰ë™ ê·œì¹™

### íŒì • ê¸°ì¤€
- ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ ì—¬ë¶€
- ë³´ì•ˆ ì´ìŠˆ ì—†ìŒ
- briefing ìš”êµ¬ì‚¬í•­ ì¶©ì¡±
- ì½”ë“œ í’ˆì§ˆ ê¸°ì¤€ ì¶©ì¡±

### íŒì • ê²°ê³¼

**PASS**: ëª¨ë“  ê¸°ì¤€ ì¶©ì¡±
```json
{
  "verdict": "PASS",
  "reason": "ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼, ìš”êµ¬ì‚¬í•­ ì¶©ì¡±",
  "timestamp": "..."
}
```
â†’ MRP ë””ë ‰í† ë¦¬ ìƒì„±

**FAIL**: ê¸°ì¤€ ë¯¸ì¶©ì¡± (ì¬ì‹œë„ ê°€ëŠ¥)
```json
{
  "verdict": "FAIL",
  "reason": "í…ŒìŠ¤íŠ¸ 2ê°œ ì‹¤íŒ¨",
  "issues": ["ì´ìŠˆ1", "ì´ìŠˆ2"],
  "timestamp": "..."
}
```
â†’ review.mdì— ìƒì„¸ í”¼ë“œë°±, Builder ì¬ì‹œë„

**NEEDS_HUMAN**: ì¸ê°„ íŒë‹¨ í•„ìš”
```json
{
  "verdict": "NEEDS_HUMAN",
  "reason": "ë³´ì•ˆ ê´€ë ¨ ê²°ì • í•„ìš”",
  "timestamp": "..."
}
```
â†’ CRP ìƒì„±

## MRP ìƒì„± (PASSì¸ ê²½ìš°)

```
.orchestral/runs/{run_id}/mrp/
â”œâ”€â”€ summary.md      # ìš”ì•½
â”œâ”€â”€ code/           # ë³€ê²½ëœ ì½”ë“œ ìŠ¤ëƒ…ìƒ·
â”œâ”€â”€ tests/          # í…ŒìŠ¤íŠ¸ íŒŒì¼ ë³µì‚¬
â””â”€â”€ evidence.json   # ì¦ê±° ë§í¬
```

## ì™„ë£Œ ì¡°ê±´
- verdict.json ì‘ì„± ì™„ë£Œ
- (íŒì •ì— ë”°ë¼) MRP ë˜ëŠ” CRP ë˜ëŠ” review.md ìƒì„±

## ì¬ì‹œì‘ (VCR ì‘ë‹µ í›„)
- `/clear` í›„ ì´ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ ì¬ì‹œì‘ ìƒí™©
- ì´ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì„ ë‹¤ì‹œ ì½ìœ¼ì„¸ìš”: .orchestral/runs/{run_id}/prompts/gatekeeper.md
- vcr/ ë””ë ‰í† ë¦¬ì—ì„œ ì¸ê°„ì˜ ê²°ì • í™•ì¸
- VCR ë‚´ìš©ì„ ë°˜ì˜í•˜ì—¬ íŒì • ì¬ê°œ

## ì‹œì‘
verifier/done.flag í™•ì¸ í›„, ì „ì²´ ì•„í‹°íŒ©íŠ¸ë¥¼ ê²€í† í•˜ê³  íŒì •ì„ ì‹œì‘í•˜ì„¸ìš”.
```

### 12.5 ì—ì´ì „íŠ¸ íŠ¸ë¦¬ê±° ë©”ì»¤ë‹ˆì¦˜

ìˆœì°¨ ì‹¤í–‰ì„ ìœ„í•œ done.flag ê°ì§€ ë°©ì‹:

```bash
# Orchestratorê°€ ê° ì—ì´ì „íŠ¸ ì™„ë£Œë¥¼ ê°ì§€í•˜ëŠ” ë°©ë²•

# ë°©ë²• 1: í´ë§ (ë‹¨ìˆœ)
while [ ! -f ".orchestral/runs/{run_id}/builder/done.flag" ]; do
  sleep 2
done
# builder ì™„ë£Œ â†’ verifier ì‹œì‘

# ë°©ë²• 2: inotifywait (íš¨ìœ¨ì )
inotifywait -e create ".orchestral/runs/{run_id}/builder/"
# done.flag ìƒì„± ê°ì§€ â†’ verifier ì‹œì‘
```

### 12.6 tmux send-keysë¥¼ í†µí•œ ëª…ë ¹ì–´ ì£¼ì…

```bash
# Refiner ì‹œì‘
tmux send-keys -t orchestral-run-{timestamp}:main.0 \
  "claude --dangerously-skip-permissions --model haiku --prompt-file .orchestral/runs/{run_id}/prompts/refiner.md" Enter

# Builder ì‹œì‘ (Refiner ì™„ë£Œ í›„)
tmux send-keys -t orchestral-run-{timestamp}:main.1 \
  "claude --dangerously-skip-permissions --model sonnet --prompt-file .orchestral/runs/{run_id}/prompts/builder.md" Enter

# Verifier ì‹œì‘ (Builder ì™„ë£Œ í›„)
tmux send-keys -t orchestral-run-{timestamp}:main.2 \
  "claude --dangerously-skip-permissions --model haiku --prompt-file .orchestral/runs/{run_id}/prompts/verifier.md" Enter

# Gatekeeper ì‹œì‘ (Verifier ì™„ë£Œ í›„)
tmux send-keys -t orchestral-run-{timestamp}:main.3 \
  "claude --dangerously-skip-permissions --model sonnet --prompt-file .orchestral/runs/{run_id}/prompts/gatekeeper.md" Enter
```

### 12.7 ì¬ì‹œë„ ì‹œ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”

Gatekeeperê°€ FAIL íŒì • ì‹œ:

1. `state.json`ì˜ `iteration` ì¦ê°€
2. Builder paneì— `/clear` ëª…ë ¹ìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
3. íŠ¸ë¦¬ê±° ë©”ì‹œì§€ë¡œ ì¬ì‹œì‘ ìœ ë„

```bash
# iteration 2 ì‹œì‘ - /clearë¡œ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” í›„ ì¬ì‹œì‘
tmux send-keys -t orchestral-run-{timestamp}:main.1 "/clear" Enter
sleep 2
tmux send-keys -t orchestral-run-{timestamp}:main.1 \
  "iteration 2ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. .orchestral/runs/{run_id}/prompts/builder.md ë¥¼ ì½ê³  state.jsonì˜ iterationì„ í™•ì¸í•œ í›„ ì‘ì—…ì„ ì¬ê°œí•˜ì„¸ìš”." Enter
```

**ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì´ìœ :**
- ì´ì „ iterationì˜ ëŒ€í™” íˆìŠ¤í† ë¦¬ê°€ ëˆ„ì ë˜ë©´ ì„±ëŠ¥ ì €í•˜
- `/clear`ë¡œ ê¹¨ë—í•œ ìƒíƒœì—ì„œ ì¬ì‹œì‘
- í”„ë¡œì„¸ìŠ¤ ì¬ì‹œì‘ ì˜¤ë²„í—¤ë“œ ì—†ìŒ

### 12.8 CRP ë°œìƒ ì‹œ íë¦„

1. ì—ì´ì „íŠ¸ê°€ `crp/crp-{n}.json` ìƒì„±
2. ACE ì„œë²„ê°€ íŒŒì¼ ê°ì§€ (inotify ë˜ëŠ” í´ë§)
3. ì›¹ UIì— ì•Œë¦¼ í‘œì‹œ
4. ì¸ê°„ì´ ì‘ë‹µ â†’ `vcr/vcr-{n}.json` ìƒì„±
5. ACE ì„œë²„ê°€ VCR ê°ì§€ â†’ í•´ë‹¹ ì—ì´ì „íŠ¸ `/clear` í›„ ì¬ì‹œì‘

```bash
# VCR ì‘ë‹µ í›„ ì—ì´ì „íŠ¸ ì¬ì‹œì‘ (ì˜ˆ: refiner)
tmux send-keys -t orchestral-run-{timestamp}:main.0 "/clear" Enter
sleep 2
tmux send-keys -t orchestral-run-{timestamp}:main.0 \
  "VCR ì‘ë‹µì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤. .orchestral/runs/{run_id}/vcr/ ë¥¼ í™•ì¸í•˜ê³  ì‘ì—…ì„ ì¬ê°œí•˜ì„¸ìš”." Enter
```

---

## 13. ì•Œë¦¼ ë° ì „í™˜ ë©”ì»¤ë‹ˆì¦˜

### 13.1 ì´ë²¤íŠ¸ ìœ í˜•

| ì´ë²¤íŠ¸ | íŠ¸ë¦¬ê±° | ì‹¬ê°ë„ | ì•¡ì…˜ |
|--------|--------|--------|------|
| `agent.started` | ì—ì´ì „íŠ¸ ì‹¤í–‰ ì‹œì‘ | info | ìƒíƒœ ì—…ë°ì´íŠ¸, UI ê°±ì‹  |
| `agent.completed` | done.flag ìƒì„± | info | ë‹¤ìŒ ì—ì´ì „íŠ¸ ì‹œì‘, UI ê°±ì‹  |
| `agent.failed` | error.flag ìƒì„± ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ í¬ë˜ì‹œ | error | ì¤‘ë‹¨, ì•Œë¦¼, ì¸ê°„ ê°œì… ìš”ì²­ |
| `agent.timeout` | ì œí•œ ì‹œê°„ ì´ˆê³¼ | warning | ê²½ê³ , ì¬ì‹œë„ ë˜ëŠ” ì¤‘ë‹¨ ì„ íƒ |
| `crp.created` | CRP íŒŒì¼ ìƒì„± | warning | ì¸ê°„ ì…ë ¥ í•„ìš” ì•Œë¦¼ |
| `vcr.created` | VCR íŒŒì¼ ìƒì„± | info | í•´ë‹¹ ì—ì´ì „íŠ¸ ì¬ì‹œì‘ |
| `mrp.created` | MRP ë””ë ‰í† ë¦¬ ìƒì„± | success | ì™„ë£Œ ì•Œë¦¼, ê²€í†  ìš”ì²­ |
| `iteration.started` | ì¬ì‹œë„ ì‹œì‘ | info | ìƒíƒœ ì—…ë°ì´íŠ¸ |
| `iteration.exhausted` | max_iterations ë„ë‹¬ | error | ì¤‘ë‹¨, ì¸ê°„ ê°œì… ìš”ì²­ |

### 13.2 ì•Œë¦¼ ì±„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì•Œë¦¼ ì‹œìŠ¤í…œ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   ì´ë²¤íŠ¸ ë°œìƒ                                                 â”‚
â”‚        â”‚                                                     â”‚
â”‚        â–¼                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚ Event Bus   â”‚                                            â”‚
â”‚   â”‚ (EventEmitter)                                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚          â”‚                                                   â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚          â–¼                â–¼                â–¼               â–¼ â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ WebSocket  â”‚   â”‚ Terminal   â”‚   â”‚ System     â”‚  â”‚File â”‚ â”‚
â”‚   â”‚ (ì‹¤ì‹œê°„ UI) â”‚   â”‚ Bell       â”‚   â”‚ Notify     â”‚  â”‚Log  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**WebSocket (í•„ìˆ˜)**
- ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì›¹ UIì— í‘¸ì‹œ
- ì—°ê²° ëŠê¹€ ì‹œ ì¬ì—°ê²° ë° ìƒíƒœ ë™ê¸°í™”

**Terminal Bell (ì„ íƒ)**
- ì¸ê°„ ê°œì… í•„ìš” ì‹œ í„°ë¯¸ë„ ë²¨ ìš¸ë¦¼ (`\a`)
- `config.global.terminal_bell: true`ë¡œ í™œì„±í™”

**System Notification (ì„ íƒ)**
- macOS: `osascript -e 'display notification'`
- Linux: `notify-send`
- `config.global.system_notify: true`ë¡œ í™œì„±í™”

**File Log (í•„ìˆ˜)**
- ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ `events.log`ì— ê¸°ë¡
- ì¬í˜„ ë° ë””ë²„ê¹…ìš©

### 13.3 state.json í™•ì¥

```json
{
  "run_id": "run-20240115-143022",
  "phase": "build",
  "iteration": 1,
  "max_iterations": 3,
  "started_at": "2024-01-15T14:30:22Z",
  "updated_at": "2024-01-15T14:32:15Z",
  "agents": {
    "refiner": {
      "status": "completed",
      "started_at": "2024-01-15T14:30:25Z",
      "completed_at": "2024-01-15T14:31:00Z",
      "error": null
    },
    "builder": {
      "status": "running",
      "started_at": "2024-01-15T14:31:05Z",
      "completed_at": null,
      "error": null,
      "timeout_at": "2024-01-15T14:41:05Z"
    },
    "verifier": {
      "status": "pending",
      "started_at": null,
      "completed_at": null,
      "error": null
    },
    "gatekeeper": {
      "status": "pending",
      "started_at": null,
      "completed_at": null,
      "error": null
    }
  },
  "pending_crp": null,
  "last_event": {
    "type": "agent.started",
    "agent": "builder",
    "timestamp": "2024-01-15T14:31:05Z"
  },
  "errors": [],
  "history": [
    {
      "phase": "refine",
      "result": "completed",
      "timestamp": "2024-01-15T14:31:00Z",
      "duration_ms": 35000
    }
  ]
}
```

**ì—ì´ì „íŠ¸ status ê°’:**
- `pending` - ì•„ì§ ì‹œì‘ ì•ˆ ë¨
- `running` - ì‹¤í–‰ ì¤‘
- `completed` - ì •ìƒ ì™„ë£Œ
- `failed` - ì—ëŸ¬ë¡œ ì‹¤íŒ¨
- `timeout` - ì‹œê°„ ì´ˆê³¼
- `waiting_human` - ì¸ê°„ ì…ë ¥ ëŒ€ê¸° ì¤‘

### 13.4 ì—ëŸ¬ ì²˜ë¦¬

**error.flag íŒŒì¼ í˜•ì‹:**
```json
{
  "agent": "builder",
  "error_type": "crash",
  "message": "Unexpected token in JSON",
  "stack": "...",
  "timestamp": "2024-01-15T14:35:00Z",
  "recoverable": false
}
```

**ì—ëŸ¬ ìœ í˜•:**

| ìœ í˜• | ì„¤ëª… | ë³µêµ¬ ê°€ëŠ¥ | ì•¡ì…˜ |
|------|------|----------|------|
| `crash` | í”„ë¡œì„¸ìŠ¤ ë¹„ì •ìƒ ì¢…ë£Œ | ì¬ì‹œë„ ê°€ëŠ¥ | ìë™ ì¬ì‹œë„ ë˜ëŠ” ì¤‘ë‹¨ ì„ íƒ |
| `timeout` | ì‹œê°„ ì´ˆê³¼ | ì¬ì‹œë„ ê°€ëŠ¥ | íƒ€ì„ì•„ì›ƒ ì—°ì¥ ë˜ëŠ” ì¤‘ë‹¨ ì„ íƒ |
| `validation` | ì¶œë ¥ í˜•ì‹ ì˜¤ë¥˜ | ì¬ì‹œë„ ê°€ëŠ¥ | ìë™ ì¬ì‹œë„ |
| `permission` | íŒŒì¼/ëª…ë ¹ ê¶Œí•œ ì˜¤ë¥˜ | ë³µêµ¬ ë¶ˆê°€ | ì¦‰ì‹œ ì¤‘ë‹¨, ì¸ê°„ ê°œì… |
| `resource` | ë©”ëª¨ë¦¬/ë””ìŠ¤í¬ ë¶€ì¡± | ë³µêµ¬ ë¶ˆê°€ | ì¦‰ì‹œ ì¤‘ë‹¨, ì¸ê°„ ê°œì… |

**ì—ëŸ¬ ë°œìƒ ì‹œ íë¦„:**
```
ì—ëŸ¬ ë°œìƒ
    â”‚
    â–¼
error.flag ìƒì„±
    â”‚
    â–¼
state.json ì—…ë°ì´íŠ¸ (status: "failed")
    â”‚
    â–¼
ì´ë²¤íŠ¸ ë°œì†¡ (agent.failed)
    â”‚
    â”œâ”€ ë³µêµ¬ ê°€ëŠ¥ + ìë™ ì¬ì‹œë„ ì„¤ì •
    â”‚       â”‚
    â”‚       â–¼
    â”‚   ìë™ ì¬ì‹œë„ (ìµœëŒ€ 2íšŒ)
    â”‚       â”‚
    â”‚       â”œâ”€ ì„±ê³µ â†’ ê³„ì† ì§„í–‰
    â”‚       â””â”€ ì‹¤íŒ¨ â†’ ì¸ê°„ ê°œì… ìš”ì²­
    â”‚
    â””â”€ ë³µêµ¬ ë¶ˆê°€ ë˜ëŠ” ìë™ ì¬ì‹œë„ ì†Œì§„
            â”‚
            â–¼
        ì¸ê°„ ê°œì… ìš”ì²­ (ì•Œë¦¼)
            â”‚
            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ì›¹ UI ì˜µì…˜ í‘œì‹œ    â”‚
        â”‚  - ì¬ì‹œë„            â”‚
        â”‚  - ì„¤ì • ë³€ê²½ í›„ ì¬ì‹œë„â”‚
        â”‚  - Run ì¤‘ë‹¨          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.5 íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬

**ê¸°ë³¸ íƒ€ì„ì•„ì›ƒ (global.json):**
```json
{
  "timeouts": {
    "refiner": 300000,
    "builder": 600000,
    "verifier": 300000,
    "gatekeeper": 300000
  },
  "timeout_action": "warn"
}
```

| ê°’ (ms) | ì—ì´ì „íŠ¸ | ì„¤ëª… |
|---------|---------|------|
| 300000 | Refiner | 5ë¶„ |
| 600000 | Builder | 10ë¶„ (ì½”ë“œ ìƒì„±ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŒ) |
| 300000 | Verifier | 5ë¶„ |
| 300000 | Gatekeeper | 5ë¶„ |

**timeout_action ì˜µì…˜:**
- `warn` - ê²½ê³  ì•Œë¦¼ë§Œ, ê³„ì† ëŒ€ê¸°
- `retry` - ìë™ ì¬ì‹œë„
- `stop` - ì¦‰ì‹œ ì¤‘ë‹¨

**íƒ€ì„ì•„ì›ƒ ê°ì§€ (Orchestrator):**
```javascript
// ê° ì—ì´ì „íŠ¸ ì‹œì‘ ì‹œ íƒ€ì´ë¨¸ ì„¤ì •
const timeoutId = setTimeout(() => {
  if (agent.status === 'running') {
    emitEvent('agent.timeout', { agent: agentName });

    if (config.timeout_action === 'stop') {
      stopAgent(agentName);
    } else if (config.timeout_action === 'retry') {
      restartAgent(agentName);
    }
    // 'warn'ì¸ ê²½ìš° ì•Œë¦¼ë§Œ ë³´ë‚´ê³  ê³„ì† ëŒ€ê¸°
  }
}, config.timeouts[agentName]);
```

### 13.6 WebSocket ì´ë²¤íŠ¸ ëª…ì„¸

**ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸:**

```typescript
interface WebSocketEvent {
  type: string;
  payload: object;
  timestamp: string;
}

// ì˜ˆì‹œ ì´ë²¤íŠ¸ë“¤
{ type: 'agent.started', payload: { agent: 'builder' }, timestamp: '...' }
{ type: 'agent.completed', payload: { agent: 'builder', duration_ms: 45000 }, timestamp: '...' }
{ type: 'agent.failed', payload: { agent: 'builder', error: {...} }, timestamp: '...' }
{ type: 'agent.timeout', payload: { agent: 'builder', elapsed_ms: 600000 }, timestamp: '...' }
{ type: 'crp.created', payload: { crp_id: 'crp-001', agent: 'refiner' }, timestamp: '...' }
{ type: 'phase.changed', payload: { from: 'build', to: 'verify' }, timestamp: '...' }
{ type: 'run.completed', payload: { verdict: 'PASS' }, timestamp: '...' }
{ type: 'run.failed', payload: { reason: 'max_iterations_exceeded' }, timestamp: '...' }
```

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„:**

```typescript
{ type: 'retry.agent', payload: { agent: 'builder' } }
{ type: 'stop.run', payload: {} }
{ type: 'extend.timeout', payload: { agent: 'builder', additional_ms: 300000 } }
{ type: 'vcr.submit', payload: { crp_id: 'crp-001', decision: 'A', rationale: '...' } }
```

### 13.7 ì›¹ UI ì•Œë¦¼ í‘œì‹œ

**í† ìŠ¤íŠ¸ ì•Œë¦¼:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Builder completed (45s)         [Ã—]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš  Verifier timeout - action needed [Ã—] â”‚
â”‚   [Extend] [Retry] [Stop]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Builder failed - crash         [Ã—]  â”‚
â”‚   [View Error] [Retry] [Stop]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”” CRP created - input needed     [Ã—]  â”‚
â”‚   [Respond Now]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒíƒœ í‘œì‹œì¤„ ì—…ë°ì´íŠ¸:**
```
[âœ“ Refine] â†’ [â— Build] â†’ [ Verify] â†’ [ Gate]
              â†‘
         "Building... (2:34)"

[âœ“ Refine] â†’ [âœ“ Build] â†’ [âš  Verify] â†’ [ Gate]
                           â†‘
                    "Timeout - waiting for action"
```

### 13.8 events.log í˜•ì‹

```
.orchestral/runs/{run_id}/events.log
```

```
2024-01-15T14:30:22Z [INFO] run.started run_id=run-20240115-143022
2024-01-15T14:30:25Z [INFO] agent.started agent=refiner
2024-01-15T14:31:00Z [INFO] agent.completed agent=refiner duration_ms=35000
2024-01-15T14:31:00Z [INFO] phase.changed from=refine to=build
2024-01-15T14:31:05Z [INFO] agent.started agent=builder
2024-01-15T14:35:00Z [ERROR] agent.failed agent=builder error_type=crash message="Unexpected token"
2024-01-15T14:35:00Z [INFO] agent.retry agent=builder attempt=1
2024-01-15T14:35:05Z [INFO] agent.started agent=builder
...
```

---

## 14. êµ¬í˜„ ìš°ì„ ìˆœìœ„ (MVP)

> **Note:** ì•Œë¦¼ ì‹œìŠ¤í…œì€ Phase 3 (ì›¹ì„œë²„)ì™€ Phase 4 (í†µí•©)ì—ì„œ êµ¬í˜„

### Phase 1: í•µì‹¬ êµ¬ì¡°

1. **CLI ê¸°ë³¸** - `orchestral start` ëª…ë ¹ì–´
2. **í´ë” êµ¬ì¡° ìƒì„±** - `.orchestral/` ì´ˆê¸°í™”
3. **state.json ê´€ë¦¬** - ìƒíƒœ ì½ê¸°/ì“°ê¸°
4. **tmux ì„¸ì…˜ ìƒì„±** - ê¸°ë³¸ ë ˆì´ì•„ì›ƒ

### Phase 2: ì—ì´ì „íŠ¸ ì‹¤í–‰

1. **Refiner êµ¬í˜„** - briefing ì²˜ë¦¬
2. **Builder êµ¬í˜„** - ì½”ë“œ ìƒì„±
3. **Verifier êµ¬í˜„** - í…ŒìŠ¤íŠ¸ ìƒì„±/ì‹¤í–‰
4. **Gatekeeper êµ¬í˜„** - íŒì • ë¡œì§

### Phase 3: ì›¹ì„œë²„

1. **ê¸°ë³¸ ì„œë²„** - Express ê¸°ë°˜
2. **ëŒ€ì‹œë³´ë“œ** - ìƒíƒœ í‘œì‹œ
3. **CRP í˜ì´ì§€** - ì¸ê°„ ì‘ë‹µ ìˆ˜ì§‘
4. **MRP í˜ì´ì§€** - ê²°ê³¼ ê²€í† 

### Phase 4: í†µí•©

1. **ì‹¤ì‹œê°„ ìƒíƒœ ë™ê¸°í™”** - ì›¹ì†Œì¼“
2. **ì„¤ì • UI** - ì—ì´ì „íŠ¸ ì„¤ì •
3. **íˆìŠ¤í† ë¦¬** - ê³¼ê±° run ì¡°íšŒ

---

## 15. ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ì„±ìš”ì†Œ | ê¸°ìˆ  |
|---------|------|
| CLI | Node.js + Commander.js |
| ì›¹ì„œë²„ | Express + Socket.io |
| í”„ë¡ íŠ¸ì—”ë“œ | React (ë˜ëŠ” Vanilla JS for MVP) |
| ì—ì´ì „íŠ¸ ì‹¤í–‰ | Claude Code CLI (headless) |
| í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ | tmux |
| ìƒíƒœ ì €ì¥ | JSON íŒŒì¼ |

---

## 16. ì œì™¸ ì‚¬í•­ (MVP ë²”ìœ„ ë°–)

- í™”ë ¤í•œ UI
- ìë™ ë¨¸ì§€
- ë¹„ìš© ìµœì í™”
- í´ë¼ìš°ë“œ ë°°í¬
- ë©€í‹° ìœ ì €
- Git í†µí•© ìë™í™”

---

## 17. ì„±ê³µ ê¸°ì¤€

MVPê°€ ì„±ê³µì ìœ¼ë¡œ ë™ì‘í•œë‹¤ëŠ” ê²ƒì€:

1. `orchestral start` â†’ ì›¹ì„œë²„ ì‹œì‘
2. Briefing ì…ë ¥ â†’ 4ê°œ ì—ì´ì „íŠ¸ ìˆœì°¨ ì‹¤í–‰
3. CRP ë°œìƒ ì‹œ â†’ ì›¹ì—ì„œ ì‘ë‹µ ê°€ëŠ¥
4. ìµœì¢… MRP ìƒì„± â†’ ì¸ê°„ì´ ê²€í†  ê°€ëŠ¥
5. ì „ì²´ ê³¼ì •ì´ ë¡œê·¸ë¡œ ê¸°ë¡ë¨
6. ë‹¨ê³„ ì „í™˜ ì‹œ â†’ ì›¹ UI ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
7. ì—ëŸ¬/íƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ â†’ ì•Œë¦¼ ë° ë³µêµ¬ ì˜µì…˜ ì œê³µ
8. ëª¨ë“  ì´ë²¤íŠ¸ê°€ events.logì— ê¸°ë¡ë¨
