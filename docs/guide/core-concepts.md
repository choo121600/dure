# í•µì‹¬ ê°œë…

Dureì„ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´í•´í•´ì•¼ í•  í•µì‹¬ ê°œë…ë“¤ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ì„¤ê³„ ì›ì¹™

Dureì€ ë‹¤ìŒ ì›ì¹™ì— ë”°ë¼ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤:

### 1. ì¸ê°„ì€ íŒë‹¨ ë…¸ë“œë‹¤

**ì¸ê°„ì€ ì‘ì—…ìê°€ ì•„ë‹ˆë¼ ê²°ì •ê¶Œìì…ë‹ˆë‹¤.**

```mermaid
graph LR
    A[ì—ì´ì „íŠ¸ ì‹¤í–‰] --> B{íŒë‹¨ í•„ìš”?}
    B -->|Yes| C[ì¸ê°„ ê°œì…]
    B -->|No| D[ê³„ì† ì§„í–‰]
    C --> A
    D --> E[ì™„ë£Œ]
```

- âœ… ì—ì´ì „íŠ¸ê°€ ëª¨ë“  ì‘ì—… ìˆ˜í–‰
- âœ… ì¸ê°„ì€ ì¤‘ìš”í•œ ê²°ì •ë§Œ ë‚´ë¦¼
- âŒ ì¸ê°„ì´ ì§ì ‘ ì½”ë“œ ì‘ì„±í•˜ì§€ ì•ŠìŒ
- âŒ ì¸ê°„ì´ ì¤‘ê°„ ê³¼ì •ì— ê°œì…í•˜ì§€ ì•ŠìŒ

### 2. ê¶¤ì (Trajectory)ì´ 1ê¸‰ ì‚°ì¶œë¬¼

**ê²°ê³¼ë¬¼ë³´ë‹¤ ë„ë‹¬ ê³¼ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.**

ëª¨ë“  ì‹¤í–‰ì€ ì™„ì „íˆ ê¸°ë¡ë˜ì–´:

- ğŸ“ ëª¨ë“  ì—ì´ì „íŠ¸ ë¡œê·¸
- ğŸ” ëª¨ë“  ê²°ì • ê·¼ê±°
- â±ï¸ ëª¨ë“  ì´ë²¤íŠ¸ íƒ€ì„ìŠ¤íƒ¬í”„
- ğŸ’° ëª¨ë“  í† í° ì‚¬ìš©ëŸ‰

ì´ ì •ë³´ëŠ” `.dure/runs/{run_id}/` ì— ì˜êµ¬ ì €ì¥ë©ë‹ˆë‹¤.

### 3. ì¬í˜„ ê°€ëŠ¥í•´ì•¼ í•œë‹¤

ê°™ì€ Briefingê³¼ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰í•˜ë©´ ìœ ì‚¬í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

```bash
# ê³¼ê±° run ì¬í˜„
dure replay run-20240126-143022
```

### 4. íŒŒì¼ ê¸°ë°˜ ì¡°ìœ¨

ì—ì´ì „íŠ¸ ê°„ í†µì‹ ì€ íŒŒì¼ì‹œìŠ¤í…œìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

```
Refiner â†’ briefing/refined.md â†’ Builder
Builder â†’ builder/done.flag â†’ Verifier
Verifier â†’ verifier/done.flag â†’ Gatekeeper
```

ì´ëŠ”:
- âœ… ëª…í™•í•œ ì¸í„°í˜ì´ìŠ¤
- âœ… ë””ë²„ê¹… ìš©ì´
- âœ… ì¤‘ê°„ ìƒíƒœ ê²€ì‚¬ ê°€ëŠ¥

## ì£¼ìš” ìš©ì–´

### Run

í•˜ë‚˜ì˜ Briefingë¶€í„° ìµœì¢… MRPê¹Œì§€ì˜ ì „ì²´ ì‹¤í–‰ ë‹¨ìœ„ì…ë‹ˆë‹¤.

ê° Runì€ ê³ ìœ í•œ IDë¥¼ ê°€ì§‘ë‹ˆë‹¤:

```
run-{timestamp}
ì˜ˆ: run-20240126-143022
```

### Phase

Runì€ 4ê°œì˜ Phaseë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

| Phase | ì—ì´ì „íŠ¸ | ì—­í•  |
|-------|---------|------|
| **0: refine** | Refiner | Briefing ê²€í†  ë° ê°œì„  |
| **1: build** | Builder | ì½”ë“œ êµ¬í˜„ |
| **2: verify** | Verifier | í…ŒìŠ¤íŠ¸ ìƒì„± ë° ì‹¤í–‰ |
| **3: gate** | Gatekeeper | ìµœì¢… íŒì • |

### Iteration

Gatekeeperê°€ FAIL íŒì •ì„ ë‚´ë¦¬ë©´ Builderë¡œ ëŒì•„ê°€ ì¬ì‹œë„í•©ë‹ˆë‹¤.

```
Phase 1 (Builder) â†’ Phase 2 (Verifier) â†’ Phase 3 (Gatekeeper)
                        â†‘                          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€ FAIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ê¸°ë³¸ ìµœëŒ€ iteration: **3íšŒ**

?> `config.global.max_iterations`ë¡œ ë³€ê²½ ê°€ëŠ¥

### Briefing

ì¸ê°„ì´ ì‘ì„±í•˜ëŠ” **ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ**ì…ë‹ˆë‹¤.

Markdown í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë©°, ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:

- ğŸ“‹ ìš”êµ¬ì‚¬í•­
- ğŸš« ì œì•½ ì¡°ê±´
- âœ… ì˜ˆìƒ ë™ì‘

ì¢‹ì€ Briefing ì‘ì„±ë²•ì€ [Briefing ì‘ì„± ê°€ì´ë“œ](/guide/writing-briefings.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

### CRP (Consultation Request Pack)

ì—ì´ì „íŠ¸ê°€ **ì¸ê°„ì˜ íŒë‹¨ì´ í•„ìš”í•  ë•Œ** ìƒì„±í•˜ëŠ” ì§ˆì˜ì„œì…ë‹ˆë‹¤.

CRPì—ëŠ” ë‹¤ìŒì´ í¬í•¨ë©ë‹ˆë‹¤:

```json
{
  "question": "ì§ˆë¬¸ ë‚´ìš©",
  "context": "ë§¥ë½ ì„¤ëª…",
  "options": [
    {"id": "A", "label": "ì„ íƒì§€A", "description": "...", "risk": "ë‚®ìŒ"},
    {"id": "B", "label": "ì„ íƒì§€B", "description": "...", "risk": "ë†’ìŒ"}
  ],
  "recommendation": "A"
}
```

ì¸ê°„ì´ ì‘ë‹µí•˜ë©´ **VCR**ì´ ìƒì„±ë©ë‹ˆë‹¤.

### VCR (Version Controlled Resolution)

CRPì— ëŒ€í•œ **ì¸ê°„ì˜ ê²°ì • ê¸°ë¡**ì…ë‹ˆë‹¤.

```json
{
  "crp_id": "crp-001",
  "decision": "A",
  "rationale": "MVPì—ì„œëŠ” ë‹¨ìˆœí•œ ë°©ì‹ìœ¼ë¡œ ì‹œì‘",
  "applies_to_future": true
}
```

`applies_to_future: true`ë¡œ ì„¤ì •í•˜ë©´ ìœ ì‚¬í•œ ìƒí™©ì—ì„œ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.

### MRP (Merge-Readiness Pack)

Gatekeeperê°€ PASS íŒì •ì„ ë‚´ë ¸ì„ ë•Œ ìƒì„±ë˜ëŠ” **ìµœì¢… ê²°ê³¼ë¬¼ íŒ¨í‚¤ì§€**ì…ë‹ˆë‹¤.

MRPì—ëŠ” ë‹¤ìŒì´ í¬í•¨ë©ë‹ˆë‹¤:

- ğŸ“„ `summary.md` - ë³€ê²½ ì‚¬í•­ ìš”ì•½
- ğŸ’¾ `code/` - ìµœì¢… ì½”ë“œ ìŠ¤ëƒ…ìƒ·
- ğŸ§ª `tests/` - í…ŒìŠ¤íŠ¸ íŒŒì¼
- ğŸ“Š `evidence.json` - í…ŒìŠ¤íŠ¸ ê²°ê³¼, ë¹„ìš©, ë¡œê·¸ ë§í¬

## ì—ì´ì „íŠ¸ íŒŒì´í”„ë¼ì¸

### ì „ì²´ íë¦„

```mermaid
graph TD
    A[Briefing ì‘ì„±] --> B[Refiner]
    B -->|ì¶©ë¶„| C[Builder]
    B -->|ëª¨í˜¸| D[CRP ìƒì„±]
    D --> E[ì¸ê°„ ì‘ë‹µ]
    E --> F[VCR ìƒì„±]
    F --> B
    C --> G[Verifier]
    G --> H[Gatekeeper]
    H -->|PASS| I[MRP ìƒì„±]
    H -->|FAIL| C
    H -->|NEEDS_HUMAN| D
    I --> J[ì¸ê°„ ê²€í† ]
    J -->|Approve| K[ì™„ë£Œ]
    J -->|Request Changes| C
```

### ê° ì—ì´ì „íŠ¸ì˜ ì—­í• 

#### Refiner (Phase 0)

**Briefingì„ ê²€í† í•˜ê³  ê°œì„ í•©ë‹ˆë‹¤.**

- âœ… ì¶©ë¶„í•œ Briefing â†’ ë‹¤ìŒ ë‹¨ê³„ë¡œ
- âœï¸ ê°œì„  ê°€ëŠ¥ â†’ ìë™ ë³´ì™„ (ìˆ«ì, ë„¤ì´ë° ë“±)
- â“ ëª¨í˜¸í•¨ â†’ CRP ìƒì„±

**ìë™ ê°œì„  í—ˆìš© í•­ëª©:**
- ìˆ«ì ê¸°ë³¸ê°’ (ì˜ˆ: "ì ì ˆí•œ ì œí•œ" â†’ "60íšŒ/ë¶„")
- ë„¤ì´ë° ì»¨ë²¤ì…˜
- íŒŒì¼ ê²½ë¡œ

**CRP í•„ìˆ˜ í•­ëª©:**
- ì•„í‚¤í…ì²˜ ê²°ì •
- ì™¸ë¶€ ì˜ì¡´ì„± ì¶”ê°€
- ë³´ì•ˆ ê´€ë ¨ ì‚¬í•­

#### Builder (Phase 1)

**ì½”ë“œë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.**

- ğŸ“ `refined.md` ê¸°ë°˜ìœ¼ë¡œ ì½”ë“œ ìƒì„±
- ğŸ“‹ ì„¤ê³„ ê²°ì • ê·¼ê±°ë¥¼ `log.md`ì— ê¸°ë¡
- âœ… ì™„ë£Œ ì‹œ `done.flag` ìƒì„±

#### Verifier (Phase 2)

**í…ŒìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.**

- ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ìƒì„±
- ğŸ” ê²½ê³„ ì¡°ê±´ í…ŒìŠ¤íŠ¸
- âš ï¸ ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
- ğŸ¯ ë°˜ë¡€ íƒìƒ‰ (adversarial testing)

**ì¶œë ¥:**
- `tests/` - í…ŒìŠ¤íŠ¸ íŒŒì¼
- `results.json` - í…ŒìŠ¤íŠ¸ ê²°ê³¼
- `log.md` - ê²€ì¦ ë¡œê·¸

#### Gatekeeper (Phase 3)

**ìµœì¢… íŒì •ì„ ë‚´ë¦½ë‹ˆë‹¤.**

íŒì • ê²°ê³¼:

| íŒì • | ì˜ë¯¸ | ë‹¤ìŒ ë‹¨ê³„ |
|------|------|----------|
| **PASS** | ëª¨ë“  ê¸°ì¤€ ì¶©ì¡± | MRP ìƒì„± |
| **FAIL** | ê¸°ì¤€ ë¯¸ì¶©ì¡± | Builder ì¬ì‹œë„ |
| **NEEDS_HUMAN** | ì¸ê°„ íŒë‹¨ í•„ìš” | CRP ìƒì„± |

## ìƒíƒœ ê´€ë¦¬

ê° Runì˜ ìƒíƒœëŠ” `state.json`ì— ì €ì¥ë©ë‹ˆë‹¤:

```json
{
  "run_id": "run-20240126-143022",
  "phase": "build",
  "iteration": 1,
  "max_iterations": 3,
  "agents": {
    "refiner": {"status": "completed"},
    "builder": {"status": "running"},
    "verifier": {"status": "pending"},
    "gatekeeper": {"status": "pending"}
  }
}
```

**ì—ì´ì „íŠ¸ ìƒíƒœ:**

- `pending` - ì•„ì§ ì‹œì‘ ì•ˆ ë¨
- `running` - ì‹¤í–‰ ì¤‘
- `completed` - ì •ìƒ ì™„ë£Œ
- `failed` - ì—ëŸ¬ë¡œ ì‹¤íŒ¨
- `timeout` - ì‹œê°„ ì´ˆê³¼
- `waiting_human` - ì¸ê°„ ì…ë ¥ ëŒ€ê¸° ì¤‘

## ë¹„ìš© ì¶”ì 

ëª¨ë“  ì—ì´ì „íŠ¸ì˜ í† í° ì‚¬ìš©ëŸ‰ê³¼ ë¹„ìš©ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì ë©ë‹ˆë‹¤:

```json
{
  "usage": {
    "by_agent": {
      "refiner": {"input": 2100, "output": 800, "cost": 0.002},
      "builder": {"input": 15300, "output": 4200, "cost": 0.058}
    },
    "total": {
      "input_tokens": 17400,
      "output_tokens": 5000,
      "cost_usd": 0.060
    }
  }
}
```

ëŒ€ì‹œë³´ë“œì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë‹¤ìŒ ë‹¨ê³„

- [Briefing ì‘ì„± ê°€ì´ë“œ](/guide/writing-briefings.md) - íš¨ê³¼ì ì¸ Briefing ì‘ì„± ë°©ë²•
- [ì—ì´ì „íŠ¸ ì´í•´í•˜ê¸°](/guide/understanding-agents.md) - ê° ì—ì´ì „íŠ¸ì˜ ìƒì„¸ ë™ì‘
- [ì‹œìŠ¤í…œ ê°œìš”](/architecture/overview.md) - ì•„í‚¤í…ì²˜ ìƒì„¸ ì„¤ëª…
